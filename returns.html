<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Return Items</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #f7f7f7;
        }

        .header {
            background: #423E37;
            color: #fff;
            padding: 30px 0;
            text-align: center;
        }

        .container-box {
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .item-img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
        }

        .return-btn {
            background: #E3B23C;
            border: none;
        }

        .return-btn:hover {
            background: #6E675F;
        }

        .return-check {
            width: 25px;
            height: 25px;
            cursor: pointer;
            accent-color: #E3B23C;
            border: 3px solid #E3B23C !important;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }

        .return-check:checked {
            box-shadow: 0 0 8px #E3B23C;
            transform: scale(1.15);
            accent-color: #E3B23C;
            background-color: #E3B23C;
        }
    </style>
</head>

<body>

    <header class="header">
        <h1>Return Items</h1>
        <p>Select items from your past order to return.</p>
    </header>

    <div class="container my-5">
        <div class="container-box">
            <h2 class="mb-4">Your Items</h2>

            <div id="return-items-list"></div>

            <hr>

            <h4>Reason for Return</h4>
            <select id="return-reason" class="form-select mb-3">
                <option value="">Choose a reason...</option>
                <option value="Damaged">Item arrived damaged</option>
                <option value="Incorrect">Received wrong item</option>
                <option value="Not needed">No longer needed</option>
                <option value="Other">Other</option>
            </select>

            <button id="submit-return" class="btn return-btn text-white w-100">Submit Return Request</button>

            <div id="return-message" class="mt-4"></div>
        </div>
    </div>

    <script>
        // Load cart from localStorage
        const cart = JSON.parse(localStorage.getItem("cart")) || {};
        const list = document.getElementById("return-items-list");

        function loadReturnItems() {
            let html = "";

            if (Object.keys(cart).length === 0) {
                list.innerHTML = `<p class='text-center'>You have no items to return.</p>`;
                return;
            }

            Object.values(cart).forEach(item => {
                html += `
            <div class="d-flex align-items-center border-bottom py-3">
                <input type="checkbox" class="form-check-input me-3 return-check" data-id="${item.ProductID}">
                <img src="${item.img}" class="item-img me-3">
                <div>
                    <h5>${item.name}</h5>
                    <p class="text-muted">Quantity: ${item.quantity}</p>
                </div>
            </div>
        `;
            });

            list.innerHTML = html;
        }

        loadReturnItems();
        const submitBtn = document.getElementById("submit-return");
        submitBtn.addEventListener("click", function () {
            const reason = document.getElementById("return-reason").value;
            const messageBox = document.getElementById("return-message");

            if (!reason) {
                messageBox.innerHTML = `<p class='text-danger'>Please select a return reason.</p>`;
                return;
            }

            const selectedItems = Array.from(document.querySelectorAll('.return-check:checked'))
                .map(box => box.dataset.id);

            if (selectedItems.length === 0) {
                messageBox.innerHTML = `<p class='text-danger'>Please select at least one item to return.</p>`;
                return;
            }

            // Build return request data
            const returnData = {
                items: selectedItems,
                reason: reason,
                timestamp: new Date().toISOString()
            };

            console.log("Return request submitted:", returnData);

            // ---------------- DELETE ITEMS FROM CART ----------------
            const cart = JSON.parse(localStorage.getItem("cart")) || {};
            selectedItems.forEach(id => {
                delete cart[id];
            });
            localStorage.setItem("cart", JSON.stringify(cart));
            // --------------------------------------------------------


            alert("Your return request has been submitted successfully!");
            window.location.href = "index.html";

            // Refresh the list instantly so returned items disappear
            loadReturnItems();

            });



    </script>

    <footer class="text-center py-4 text-muted">
        <p>&copy; 2025 Sunrise Brewing Co</p>
    </footer>

</body>

</html>