<!DOCTYPE html>
<html lang="en" ng-app="shippingApp">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipping</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- AngularJS -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>

    <!-- Optional custom stylesheet -->
    <link rel="stylesheet" href="./style/checkout.css">

    <style>
        body {
            animation: opening 1s ease-in-out;
            background: linear-gradient(black, transparent), url("/public/img/hero-img.jpg") center/cover fixed no-repeat;
            color: #fff;
        }

        input[type="radio"] {
            appearance: none;
            background-color: #fff;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            margin-right: .5rem;
        }

        input[type="radio"]:checked {
            background-color: #E3B23C;
            border-color: #E3B23C;
        }

        .btn-primary {
            background: #E3B23C;
            border: none;
        }

        .btn-primary:hover,
        .btn-primary:focus {
            background: #6E675F;
        }

        .badge {
            background-color: #E3B23C;
        }

        .list-inline li a {
            color: #E3B23C;
            text-decoration: none;
        }

        .error-message {
            color: #dc3545;
            font-size: 0.875em;
        }

        .form-label.required::after {
            content: " *";
            color: #dc3545;
        }

        .validation-summary {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 0.375rem;
            color: #721c24;
            padding: 1rem;
        }
    </style>
</head>

<body>

    <div class="container" ng-controller="CheckoutCtrl as vm">
        <main>
            <div class="py-5 text-center">
                <h1 class="h2">Shipping Form</h1>
            </div>

            <div class="col-md-7 col-lg-8 mx-auto">

                <!-- Validation summary -->
                <div class="validation-summary" ng-show="shippingForm.$submitted && shippingForm.$invalid">
                    <h5>Please fix the following errors:</h5>
                    <ul class="mb-0">
                        <li ng-show="shippingForm.firstName.$error.required">First name is required</li>
                        <li ng-show="shippingForm.lastName.$error.required">Last name is required</li>
                        <li ng-show="shippingForm.email.$error.required">Email is required</li>
                        <li ng-show="shippingForm.email.$error.email">Please enter a valid email address</li>
                        <li ng-show="shippingForm.address.$error.required">Address is required</li>
                        <li ng-show="shippingForm.country.$error.required">Country is required</li>
                        <li ng-show="shippingForm.state.$error.required">State is required</li>
                        <li ng-show="shippingForm.zip.$error.required">Zip code is required</li>
                        <li ng-show="shippingForm.zip.$error.pattern">Zip code must be 5 digits</li>
                    </ul>
                </div>

                <form name="shippingForm" novalidate ng-submit="vm.submitForm(shippingForm)">

                    <h4 class="mb-3">Shipping Address</h4>
                    <div class="row g-3">

                        <!-- First Name -->
                        <div class="col-sm-6">
                            <label class="form-label required">First Name</label>
                            <input type="text" class="form-control" name="firstName" ng-model="vm.firstName" required
                                ng-minlength="2" ng-maxlength="50">
                            <div class="error-message"
                                ng-show="shippingForm.firstName.$touched && shippingForm.firstName.$error.required">
                                First name is required.
                            </div>
                        </div>

                        <!-- Last Name -->
                        <div class="col-sm-6">
                            <label class="form-label required">Last Name</label>
                            <input type="text" class="form-control" name="lastName" ng-model="vm.lastName" required
                                ng-minlength="2" ng-maxlength="50">
                            <div class="error-message"
                                ng-show="shippingForm.lastName.$touched && shippingForm.lastName.$error.required">
                                Last name is required.
                            </div>
                        </div>

                        <!-- Email -->
                        <div class="col-12">
                            <label class="form-label required">Email</label>
                            <input type="email" class="form-control" name="email" ng-model="vm.email" required>
                            <div class="error-message"
                                ng-show="shippingForm.email.$touched && shippingForm.email.$error.required">
                                Email is required.
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="col-12">
                            <label class="form-label required">Address</label>
                            <input type="text" class="form-control" name="address" ng-model="vm.AddressOne" required>
                        </div>

                        <div class="col-12">
                            <label class="form-label">Address 2 <span
                                    class="text-body-secondary">(Optional)</span></label>
                            <input type="text" class="form-control" ng-model="vm.AddressTwo">
                        </div>

                        <!-- Country -->
                        <div class="col-md-5">
                            <label class="form-label required">Country</label>
                            <select class="form-select" name="country" ng-model="vm.country" required>
                                <option value="">Choose...</option>
                                <option>United States</option>
                            </select>
                        </div>

                        <!-- State -->
                        <div class="col-md-4">
                            <label class="form-label required">State</label>
                            <select class="form-select" name="state" ng-model="vm.state" required>
                                <option value="">Select a State</option>
                                <!-- states omitted for brevity but identical to your list -->
                                									<option value="">Select a State</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <option value="CO">Colorado</option>
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="DC">District of Columbia</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="HI">Hawaii</option>
                                    <option value="ID">Idaho</option>
                                    <option value="IL">Illinois</option>
                                    <option value="IN">Indiana</option>
                                    <option value="IA">Iowa</option>
                                    <option value="KS">Kansas</option>
                                    <option value="KY">Kentucky</option>
                                    <option value="LA">Louisiana</option>
                                    <option value="ME">Maine</option>
                                    <option value="MD">Maryland</option>
                                    <option value="MA">Massachusetts</option>
                                    <option value="MI">Michigan</option>
                                    <option value="MN">Minnesota</option>
                                    <option value="MS">Mississippi</option>
                                    <option value="MO">Missouri</option>
                                    <option value="MT">Montana</option>
                                    <option value="NE">Nebraska</option>
                                    <option value="NV">Nevada</option>
                                    <option value="NH">New Hampshire</option>
                                    <option value="NJ">New Jersey</option>
                                    <option value="NM">New Mexico</option>
                                    <option value="NY">New York</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="ND">North Dakota</option>
                                    <option value="OH">Ohio</option>
                                    <option value="OK">Oklahoma</option>
                                    <option value="OR">Oregon</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="RI">Rhode Island</option>
                                    <option value="SC">South Carolina</option>
                                    <option value="SD">South Dakota</option>
                                    <option value="TN">Tennessee</option>
                                    <option value="TX">Texas</option>
                                    <option value="UT">Utah</option>
                                    <option value="VT">Vermont</option>
                                    <option value="VA">Virginia</option>
                                    <option value="WA">Washington</option>
                                    <option value="WV">West Virginia</option>
                                    <option value="WI">Wisconsin</option>
                                    <option value="WY">Wyoming</option>
                            </select>
                        </div>

                        <!-- ZIP -->
                        <div class="col-md-3">
                            <label class="form-label required">Zip</label>
                            <input type="text" class="form-control" name="zip" ng-model="vm.zip" required
                                ng-pattern="/^[0-9]{5}$/">
                        </div>
                    </div>

                    <hr class="my-4">

                    <h4 class="mb-3">Select Carrier (US Only)</h4>

                    <!-- Shipping Options -->
                    <div class="form-check mb-2">
                        <label class="form-check-label">
                            <input class="form-check-input" type="radio" name="shippingOption" ng-model="vm.shipping" value="USPS" required data-price="0.00">
                                USPS Standard (3â€“5 Business Days) - Free
                        </label>
                    </div>

                    <div class="form-check mb-2">
                        <label class="form-check-label"></label>
                            <input class="form-check-input" type="radio" name="shippingOption" ng-model="vm.shipping" value="FedEx2Day" required data-price="20.00">
                            FedEx Express (Two Day) - $20.00
                        </label>
                    </div>

                    <div class="form-check">
                        <label class="form-check-label">
                        <input class="form-check-input" type="radio" name="shippingOption" ng-model="vm.shipping" value="FedExOvernight"
                            required data-price="50.00">
                            FedEx Express (Overnight) - $50.00
                        </label>
                    </div>

                    <div class="error-message" ng-show="shippingForm.$submitted && !vm.shipping">
                        Please select a shipping method.
                    </div>

                    <hr class="my-4">

                    <button class="w-100 btn btn-primary btn-lg ship_btn" type="submit">
                        Continue to Billing
                    </button>
                </form>
            </div>
        </main>

        <footer class="my-5 pt-5 text-center text-small">
            <p>&copy; 2025 Sunrise Brewing Co</p>
            <ul class="list-inline">
                <li class="list-inline-item"><a href="#">Privacy</a></li>
                <li class="list-inline-item"><a href="#">Terms</a></li>
                <li class="list-inline-item"><a href="#">Support</a></li>
            </ul>
        </footer>
    </div>

    <script>
        angular.module("shippingApp", [])
            .controller("CheckoutCtrl", function () {

                var vm = this;

                vm.submitForm = function (form) {

                    if (form) {
                        angular.forEach(form.$error, function (fields) {
                            angular.forEach(fields, function (field) {
                                field.$setTouched();
                            });
                        });
                    }

                    if (form.$valid && vm.shipping) {

                        const formData = {
                            type: "shipping",
                            firstName: vm.firstName,
                            lastName: vm.lastName,
                            email: vm.email,
                            address1: vm.AddressOne,
                            address2: vm.AddressTwo,
                            country: vm.country,
                            state: vm.state,
                            zip: vm.zip,
                            shipping: vm.shipping
                        };

                        fetch("http://localhost:3000/save-shipping", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(formData)
                        })
                            .then(res => res.json())
                            .then(data => {
                                
                            })
                            .catch(err => console.error("Error saving:", err));
                    }
                    window.location.href = "./billing.html";
                };
            });
            document.addEventListener("DOMContentLoaded", function () {

                document.querySelectorAll("input[name='shippingOption']").forEach(radio => {
                    radio.addEventListener("change", function () {

                        const price = parseFloat(this.dataset.price);
                        const method = this.value;

                        // Save the user's shipping choice
                        localStorage.setItem("selectedShipping", JSON.stringify({
                            method: method,
                            price: price
                        }));
                    });
                });
            });
            

    </script>

</body>

</html>